---
title: "Comparing 'Woody' and 'Non-Woody' soil carbon distributions"
date: 2024-05-28
author:
  - name: Ruan de Wet
    email: ruan@meatnaturallyafrica.com
  
execute:
  echo: true
  quiet: true
  message: false
  warning: false
format:
  pdf:
    toc: true
    number-sections: false
    highlight-style: github
    reference-doc: custom-reference-doc.docx
---

## Introduction

During the VCS validation audit for the VM0042 project titled [Grassland Restoration and Stewardship in South Africa (GRASS)](https://registry.verra.org/app/projectDetail/VCS/2349), a Forward Action Request (FAR) was raised regarding the sampling applied to monitor soil organic carbon stocks between rangelands of different tree densities (greater and less than 10% canopy cover). The wording of the FAR is provided below:

> VVB in the first verification will assess the stratified sampling applied by PP for the parameter SOCbsl,i,t (Areal-average soil organic carbon stocks in the baseline scenario for sample unit i in year t) to check the sampling approach and its conservativeness. PP has proposed to apply stratified random sampling in selecting sampling points to distinguish between rangelands of different tree densities (greater and less than 10% canopy cover).

Additional soil samples were collected in the 2023 sampling campaign to address this FAR. Soil samples are grouped into strata from rangelands with greater and with less than 10% canopy cover - labelled 'woody' and 'non-woody' strata, respectively.

A two-sample t-test is used in this assessment to compare the two strata. The null hypothesis is tested that the true difference in means between the two groups is equal to 0.

For transparency, all the R code used in this assessment is included in the report. Commentary is also provided throughout the assessment as a guide to the steps taken.

## Set up analysis environment

### Load libraries and read in labelled soil data

```{r Load libraries}

library(tidyverse)
library(googlesheets4)

```

```{r Read in data}

path_soc = "https://docs.google.com/spreadsheets/d/1_lMYzVxVtWFkT6H0eWf3f3STEHRBY8a8DzvZ0KAHrWE/edit#gid=0"
df_soils <- read_sheet(path_soc, sheet = "Soil Data")

```

## Exploratory Data Analysis

An initial visual exploration of the soil data will be helpful to understand what the distributions look like.

```{r EDA}

df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  group_by(Group) %>%
  summarise(count = n(),
            mean = mean(SOC, na.rm = T),
            sd = sd(SOC, na.rm = T))

df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  ggplot(aes(x = SOC, fill = Landscape_Name)) +
  geom_histogram(col = "black", bins = 30) +
  labs(x = "SOC (%)",
       y = "Frequency",
       fill = "Landscape") +
  facet_grid(Group~., scales = "free") +
  theme_minimal() +
  theme(legend.position = "bottom")

```

There is a considerable skew to the data, so a log10 transformation might better represent the SOC data as a Gaussian response variable.

```{r EDA log10 scale}

df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  mutate(SOC_log10 = log10(SOC)) %>%
  group_by(Group) %>%
  summarise(count = n(),
            mean = mean(SOC_log10, na.rm = T),
            sd = sd(SOC_log10, na.rm = T))

df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  ggplot(aes(x = SOC, fill = Landscape_Name)) +
  geom_histogram(col = "black", bins = 30) +
  scale_x_log10() +
  labs(x = "SOC (%)\nlog10 scale",
       y = "Frequency",
       fill = "Landscape") +
  facet_grid(Group~., scales = "free") +
  theme_minimal() +
  theme(legend.position = "bottom")

df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  ggplot(aes(x = Group, y = SOC)) +
  geom_boxplot(outlier.alpha = 0, fill = "grey") +
  # geom_violin() +
  geom_point(aes(fill = Landscape_Name), shape = 21, 
             position = position_jitter(height = 0, width = 0.1, 
                                        seed = 123)) +
  # geom_histogram(col = "black") +
  scale_y_log10() +
  labs(y = "SOC (%)\nlog10 scale",
       x = "",
       fill = "Landscape") +
  # facet_grid(Group~., scales = "free") +
  theme_minimal() +
  theme(legend.position = "bottom")

```

```{r Final test data}

df_soc = df_soils %>% 
  dplyr::select(Site_ID:Sample_Year, SOC = SOC_perc) %>%
  filter(!is.na(SOC)) %>%
  mutate(SOC_log10 = log10(SOC))

```

## Parametric Test Assumptions

In order to apply a parametric t-test, the data should be Gaussian (normally distributed) and homoscedastic (equal variance). If these assumptions are violated, then an alternative test, such as the Welch t-test, may be required.

For more information on the steps followed in this analysis, please refer to this website: <http://www.sthda.com/english/wiki/unpaired-two-samples-t-test-in-r>

### Normal distribution

A visual inspection of the log10-transformed SOC data indicates that the data are normally distributed. The Shapiro-Wilk normality test can be used to test this more quantitatively. The null hypothesis is that the data are normal. If p-value \> 0.05, then the data are not significantly different from normal.

```{r Test for normality}

with(df_soc, shapiro.test(SOC_log10[Group == "Non-Woody"])) # p-value = 0.0665
with(df_soc, shapiro.test(SOC_log10[Group == "Woody"])) # p-value = 0.07873

```

For both "Woody" and "Non-Woody" data, the p-values are \> 0.05. We can therefore assume normality for both datasets.

### Equal variance

The homogeneity in variances of the two groups can be tested with an F-test. The null hypothesis is that the ratio of variances is equal to 1.

```{r Test for equal variance}

var.test(SOC_log10 ~ Group, data = df_soc) # p-value = 0.009006

```

The p-value is \< 0.05. We can therefore reject the null hypothesis and infer that the ratio of variances are not equal to 1. The data have therefore failed the test of equal variance and a non-parametric two-sample t-test (Welch t-test) needs to be applied.

## Welch two-sample t-test

The null hypothesis of the t-test is that the true difference in means between the two groups is equal to 0. There's no prior expectation that one group would be greater or less than the other, so a two-sided hypothesis is applied by default.

```{r}

res <- t.test(SOC_log10 ~ Group, data = df_soc, var.equal = FALSE) # p-value = 0.2579
res

```

## Conclusion

The p-value is \> 0.05, so the null hypothesis cannot be rejected, and it can be concluded that ***there is no difference in SOC between the Woody and Non-Woody groups***.
